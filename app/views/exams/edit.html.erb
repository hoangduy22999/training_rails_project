<div class="card" id="search-results">
  <div>
    <%= form_for @exam do |f| %>
      <div class="box-body">          
        <%= f.label :"Name:", class: "col-sm-2" %>
        <%= f.text_field :name,  class: "form-control col-sm-9 ms-2 mb-2 d-inline", required: "required" %>
        <br />
        <%= f.label "time:", class: "col-sm-2" %>
        <%= f.select :time, options_for_select(time_exam), {}, class: 'form-select col-sm-2 ms-2 mb-2 d-inline', required: "required" %>
        <br />
        <%= f.label "Questions:", class: "col-sm-2" %>
        <div class="ms-2 d-inline h-4">
          <%= select_tag :questions, options_for_select(@questions, selected: f.object.questions.ids), {class: 'js-example-basic-multiple col-sm-6',name: "questions[]", multiple: "multiple"} %>
        </div>
      </div>
      <div class="box-footer clearfix">
        <%= f.submit "Update Exam", class: "btn btn-sm btn-info btn-flat pull-left btn-add mt-4 mb-2 ms-2 " %>
        <%= link_to "Delete Exam", exam_path(@exam) , data: { confirm: 'Are you sure?' }, method: :delete, class: 'btn btn-sm btn-danger btn-flat pull-left btn-add mt-3' %>
        <%= link_to "Try Start", exam_path(@exam), class: 'btn btn-sm btn-primary btn-flat pull-left btn-add mt-3' %>
      </div>
    <% end %>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('.js-example-basic-multiple').select2({
      placeholder: "Select a question",
      require: "required", 
      ajax:{
        url: 'exam/find_question',
        dataType: 'json',
        data: function(params){
          var questionID = $(this).val();
          return { search_content: params.term, selected_question_id: questionID }
        },
        processResults: function(data){
          return { results: data.results};
        },
      },
      templateResult: formatResult,
  
    }).trigger('change');
  
    function formatResult(question) {
      return question.content;
    }
    
    function formatSelection(question) {
      return question.content || question.text;
    }
  
  });
</script>